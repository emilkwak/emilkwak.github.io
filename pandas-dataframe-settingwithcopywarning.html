<!DOCTYPE html>
<html>
<head>
    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Page Meta -->
    <title>Pandas의 DataFrame 사용 중 SettingWithCopyWarning 발생할 때</title>
    <meta name="description" content="Python, Pandas를 Excel보다 사랑하는 직장인을 위한 블로그 " />

    <!-- Mobile Meta -->
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Brand icon -->
    <link rel="shortcut icon" href="/assets/images/favicon.ico" >

    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
    <link rel="stylesheet" type="text/css" href="/assets/css/syntax.css" />

    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!-- Ghost outputs important style and meta data with this tag -->
        <link rel="canonical" href="https://emilkwak.github.io//pandas-dataframe-settingwithcopywarning" />
    <meta name="referrer" content="origin" />
    <link rel="next" href="/page2/" />

    <meta property="og:site_name" content="직장인을 위한 Python" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Pandas의 DataFrame 사용 중 SettingWithCopyWarning 발생할 때" />
    <meta property="og:description" content="Python, Pandas를 Excel보다 사랑하는 직장인을 위한 블로그 " />
    <meta property="og:url" content="https://emilkwak.github.io//pandas-dataframe-settingwithcopywarning" />
    <meta property="og:image" content="/assets/images/office01.jpg" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Pandas의 DataFrame 사용 중 SettingWithCopyWarning 발생할 때" />
    <meta name="twitter:description" content="Python, Pandas를 Excel보다 사랑하는 직장인을 위한 블로그 " />
    <meta name="twitter:url" content="https://emilkwak.github.io//pandas-dataframe-settingwithcopywarning" />
    <meta name="twitter:image:src" content="/assets/images/office01.jpg" />

    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Website",
    "publisher": "직장인을 위한 Python",
    "name": "Pandas의 DataFrame 사용 중 SettingWithCopyWarning 발생할 때",
    "url": "https://emilkwak.github.io//pandas-dataframe-settingwithcopywarning",
    "image": "/assets/images/office01.jpg",
    "description": "Python, Pandas를 Excel보다 사랑하는 직장인을 위한 블로그 "
}
    </script>

    <meta name="generator" content="Jekyll 3.0.0" />
    <link rel="alternate" type="application/rss+xml" title="직장인을 위한 Python" href="/feed.xml" />


</head>
<body class="home-template nav-closed">

    <!-- The blog navigation links -->
    <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        <li class="nav-home " role="presentation"><a href="/">Home</a></li>
        <li class="nav-about " role="presentation"><a href="/about">About</a></li>
        <!--<li class="nav-fables " role="presentation"><a href="/tag/fables">Fables</a></li>-->
        <!--<li class="nav-speeches " role="presentation"><a href="/tag/speeches">Speeches</a></li>-->
        <!--<li class="nav-fiction " role="presentation"><a href="/tag/fiction">Fiction</a></li>-->
        <li class="nav-python " role="presentation"><a href="/tag/python">Python</a></li>
        <li class="nav-python " role="presentation"><a href="/tag/tech">Tech</a></li>
        <!--<li class="nav-author " role="presentation"><a href="/author/casper">Casper</a></li>-->
        <!--<li class="nav-author " role="presentation"><a href="/author/edgar">Edgar</a></li>-->
        <!--<li class="nav-author " role="presentation"><a href="/author/abraham">Abraham</a></li>-->
        <!--<li class="nav-author " role="presentation"><a href="/author/martin">Martin</a></li>-->
        <!--<li class="nav-author " role="presentation"><a href="/author/lewis">Lewis</a></li>-->
        <li class="nav-author " role="presentation"><a href="/author/emil">Emil</a></li>
    </ul>
	<!--
	<script type="text/javascript" src="//ra.revolvermaps.com/0/0/5.js?i=08l21hws0p1&amp;m=0&amp;c=ff0000&amp;cr1=ffffff" async="async"></script>
	-->
	<center>
        <a href="https://info.flagcounter.com/U7Uy"><img src="https://s01.flagcounter.com/count/U7Uy/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_10/viewers_0/labels_1/pageviews_1/flags_0/percent_0/" alt="Flag Counter" border="0"></a>
	</center>
    <a class="subscribe-button icon-feed" href="/feed.xml">Subscribe</a>
</div>
<span class="nav-cover"></span>


    <div class="site-wrapper">

        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The comment above "< default" means - insert everything in this file into -->
    <!-- the [body] of the default.hbs template, which contains our header/footer. -->

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<header class="main-header post-head " style="background-image: url(/assets/images/office01.jpg) ">
    <nav class="main-nav  overlay  clearfix">
        <a class="blog-logo" href="/"><img src="/assets/images/pooh03.png" alt="Blog Logo" /></a>
        
            <a class="menu-button icon-menu" href="#"><span class="word">Menu</span></a>
        
    </nav>
</header>

<main class="content" role="main">

    <article class="post tag-speeches">

        <header class="post-header">
            <h1 class="post-title">Pandas의 DataFrame 사용 중 SettingWithCopyWarning 발생할 때</h1>
            <section class="post-meta">
            <!-- <a href='/'></a> -->

            
                
            
                
            
                
            
                
            
                
            
                
                    <a href='/author/emil'>Emil Kwak</a>
                
            
            <time class="post-date" datetime="2019-07-08">09 Jul 2019</time>
                <!-- [[tags prefix=" on "]] -->
                
                on
                
                    
                       <a href='/tag/tech'>Tech</a>,
                    
                
                    
                       <a href='/tag/python'>Python</a>,
                    
                
                    
                       <a href='/tag/pandas'>Pandas</a>,
                    
                
                    
                       <a href='/tag/dataframe'>Dataframe</a>,
                    
                
                    
                       <a href='/tag/settingwithcopywarning'>Settingwithcopywarning</a>
                    
                
                
            </section>
        </header>

        <section class="post-content">

            <p>Python의 Pandas 라이브러리 사용자에게 DataFrame은 매우 중요한 도구입니다. R 언어의 데이터프레임을 대체하기 위해 고안된 Pandas DataFrame은 이제 R을 훨씬 뛰어넘어 데이터 처리의 절대적인 도구로서 위치를 점하고 있습니다.</p>

<p>Pandas DataFrame은 R 언어의 관련 기능을 상당수를 대체한 것에 모자라, 커서(cursor)로 처리하는 고수준(high-level) 프로그래밍 언어에서의 SQL 처리와 PL/SQL을 대체했습니다. 최근에는 Excel 등 스프레드시트(spreadsheet)의 기능도 대체하기 시작했고요.</p>

<p>원천 자료에 일차 데이터 처리가 반영된 이차 자료를 만들고 계속적 처리를 통해 n차 자료를 만들면서, 여러 n차 자료들을 분석과 추론으로 엮어 통찰(insight)를 얻어 내는 일은 데이터 분석의 기본이자 핵심입니다.</p>

<p>이 과정에서 DataFrame을 SELECT하고(row 관점의 filtering) PROJECT하여(column 관점의 filtering) 가공된 파생 DataFrame을 만들고, 여기에 다시 연산을 가해 분석적 통찰이 반영된 DataFrame을 만듭니다. 이와 같은 과정이 여러 번 반복되지요.</p>

<p>파생된 DataFrame을 분석해 발견한 데이터를 그 DataFrame에 열(column)로서 추가하는 일 또한 자주 사용될 것입니다. 그런데 DataFrame에 열을 추가하는 과정에서 Pandas 자체에서 발생시키는 경고(warning) 메시지를 몇 번 본 적 있을 것이입니다. SettingWithCopyWarning라는 이름의 경고 말이죠.</p>

<p>이 경고가 어떤 상황에 발생하는지 원리를 이해하여 런타임 전에 미리 예방할 수 있다면 번거로움이 줄어들 것입니다. 어떤 경우에 발생할까요? 원천이 되는 DataFrame의 일부로 구성된 파생 DataFrame에 변경을 가하는 경우 발생합니다. 쉬운 예제로 SettingWithCopyWarning의 발생을 재현할 수 있지요. 아래처럼요.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span><span class="p">,</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="n">nums</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span>
<span class="c"># [-9 -3  5  9  7 -6 -2  4 -5  6]</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">nums</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'NUM'</span><span class="p">])</span>
<span class="c">#    NUM</span>
<span class="c"># 0   -9</span>
<span class="c"># 1   -3</span>
<span class="c"># 2    5</span>
<span class="c"># 3    9</span>
<span class="c"># 4    7</span>
<span class="c"># 5   -6</span>
<span class="c"># 6   -2</span>
<span class="c"># 7    4</span>
<span class="c"># 8   -5</span>
<span class="c"># 9    6</span>

<span class="n">df_positive</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">NUM</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">df_positive</span><span class="p">[</span><span class="s">'SQUARED'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_positive</span><span class="o">.</span><span class="n">NUM</span> <span class="o">**</span> <span class="mi">2</span>
<span class="c"># SettingWithCopyWarning: </span>
<span class="c"># A value is trying to be set on a copy of a slice from a DataFrame.</span>
<span class="c"># Try using .loc[row_indexer,col_indexer] = value instead</span>
<span class="c"># </span>
<span class="c"># See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy</span>

<span class="k">print</span><span class="p">(</span><span class="n">df_positive</span><span class="p">)</span>
<span class="c">#    NUM  SQUARED</span>
<span class="c"># 2    5       25</span>
<span class="c"># 3    9       81</span>
<span class="c"># 4    7       49</span>
<span class="c"># 7    4       16</span>
<span class="c"># 9    6       36</span>
</code></pre></div></div>

<p>왜 이런 경고를 발생시킬까요? 번거롭기만 하고 별 이득은 없는 validation인 것 같은데 말이지요. 그렇지 않습니다. 매우 중요한 역할을 하는 경고입니다. Pandas DataFrame은 연쇄적인(chained) 연산과 처리를 허용합니다. SQL에서 테이블을 SELECT한 결과가 다시 테이블이 되어 다시 SELECT할 수 있는 것과 유사하게, DataFrame도 그런 성질을 띱니다. 이것이 관계형 데이터베이스의 closure에 해당하는 개념인 것이죠.</p>

<p>한편 DataFrame도 자료구조(data structure)인 셈이므로 이를  표현하기 위해 메모리를 점유합니다. 등장하는 모든 DataFrame에 메모리를 할당하려 들면 금방 바닥을 보이게 되겠지요. Pandas에서는 원천 DataFrame을 생성할 때만 메모리를 할당하고 이로부터 파생되는 DataFrame은 원천 DataFrame을 이미 적재된 메모리에 접근케 하며 이로 인해 메모리를 절약합니다. 원천 DataFrame의 부분집합(subset)에 view를 형성한다 보면 됩니다.</p>

<p>파생된 DataFrame에 열(columns)을 하나 추가하면 어떻게 될까요? 한 DataFrame의 부분집합으로 이뤄진 view에 변경을 가하는 셈이지요. 원천 DataFrame에도 그 열을 붙여 줘야 할까요? 아니면 파생 DataFrame에만 붙이면 될까요? 원천 DataFrame에 그 열을 붙인다면, 파생 DataFrame에서 등장하지 않은 행(row)들에도 무언가를 붙여야 할까요, 말아야 할까요? 붙인다면 None으로 채워야 할까요?</p>

<p>이런 복잡한 질문에는 정답이 없습니다. 실제 개발하는 사람의 의도에 따라 원하는 바가 다를 수 밖에 없습니다. Pandas에서는 파생 DataFrame에 수정을 가하는 것을 권장하지 않습니다.(그래서 경고를 띄우는 것이죠.) 대신 Pandas는 copy() 메서드를 통해 파생 DataFrame에 독립적인 메모리를 부여한 뒤 여기에 수정을 가하도록 유도하지요. view를  실질화(materialization)시키는 것이죠.</p>

<p>요컨대 SettingWithCopyWarning의 발생을 예방하기 위한 가장 쉬운 방법은 파생 DataFrame에 copy() 메서드를 실행해, 원천 DataFrame과 별도인 메모리 공간을 파생 DataFrame에 부여하는 것입니다. 원천과 파생이 완전히 갈라서는 것이지요. 위에서 던졌던 복잡하고 귀찮은 질문들은 대답할 필요가 없게 되는 것이죠.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># with SettingWithCopyWarning</span>
<span class="n">df_positive</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">NUM</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">df_positive</span><span class="p">[</span><span class="s">'SQUARED'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_positive</span><span class="o">.</span><span class="n">NUM</span> <span class="o">**</span> <span class="mi">2</span>
<span class="c"># SettingWithCopyWarning: </span>
<span class="c"># A value is trying to be set on a copy of a slice from a DataFrame.</span>
<span class="c"># Try using .loc[row_indexer,col_indexer] = value instead</span>
<span class="c"># </span>
<span class="c"># See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy</span>

<span class="c"># without SettingWithCopyWarning</span>
<span class="n">df_positive</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">NUM</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_positive</span><span class="p">[</span><span class="s">'SQUARED'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_positive</span><span class="o">.</span><span class="n">NUM</span> <span class="o">**</span> <span class="mi">2</span>

<span class="k">print</span><span class="p">(</span><span class="n">df_positive</span><span class="p">)</span>
<span class="c">#    NUM  SQUARED</span>
<span class="c"># 2    5       25</span>
<span class="c"># 3    9       81</span>
<span class="c"># 4    7       49</span>
<span class="c"># 7    4       16</span>
<span class="c"># 9    6       36</span>
</code></pre></div></div>

<p>물론 이 경우 파생 DataFrame에 메모리가 부여되므로 사용 가능한 총 메모리는 줄어들게 됩니다. 이를 잘 감안해 사용해야 합니다. copy()를 막 하다 보면 어느순간 메모리가 바닥나는 상황도 생길 수 있으니까요.</p>

<p>어쨌든 SettingWithCopyWarning은 의도치 않은 구현을 경고하는 중요한 장치입니다. 경고를 무시하고 개발해도 원하는 처리가 당장 된다고 해서 SettingWithCopyWarning을 무시하는 것보다는, SettingWithCopyWarning가 발생하지 않는 방식으로 개발하는 습관이 중요합니다.</p>



        </section>

        <footer class="post-footer">

            <!-- Everything inside the #author tags pulls data from the author -->
            <!-- #author-->
            
                
            
                
            
                
            
                
            
                
            
                
                    
                        <figure class="author-image">
                            <a class="img" href="/author/emil" style="background-image: url(/assets/images/pooh01.jpg)"><span class="hidden">emil's Picture</span></a>
                        </figure>
                    

                    <section class="author">
                        <h4><a href="/author/emil">Emil Kwak</a></h4>

                        
                            <p> An ordinary salaryman making use of Python replacing Microsoft Excel in office</p>
                        
                        <div class="author-meta">
                            <span class="author-location icon-location"> Seoul, Republic of Korea</span>
                            
                        </div>
                    </section>

                    <!-- /author  -->

                    <section class="share">
                        <h4>Share this post</h4>
                        <a class="icon-twitter" href="http://twitter.com/share?text=Pandas의 DataFrame 사용 중 SettingWithCopyWarning 발생할 때&amp;url=https://emilkwak.github.iopandas-dataframe-settingwithcopywarning"
                            onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                            <span class="hidden">Twitter</span>
                        </a>
                        <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://emilkwak.github.iopandas-dataframe-settingwithcopywarning"
                            onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                            <span class="hidden">Facebook</span>
                        </a>
                        <a class="icon-google-plus" href="https://plus.google.com/share?url=https://emilkwak.github.iopandas-dataframe-settingwithcopywarning"
                           onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                            <span class="hidden">Google+</span>
                        </a>
                    </section>
                
            

            <!-- Add Disqus Comments -->
            

        </footer>

    </article>

</main>

<aside class="read-next">

    <!-- [[! next_post ]] -->
    
        <a class="read-next-story " style="background-image: url(/assets/images/office01.jpg)" href="/defaultdict-rather-than-dict">
            <section class="post">
                <h2>Python 딕셔너리(dict) 대신 쓰는 디폴트딕트(defaultdict)</h2>
                <p>딕셔너리 자료구조는 Python뿐 아니라 Java나 C++에서더 유용히 사용됩니다. Python의 딕셔너리는 `dict`라는 키워드로 선언되는데 Java 등에...</p>
            </section>
        </a>
    
    <!-- [[! /next_post ]] -->
    <!-- [[! prev_post ]] -->
    
        <a class="read-next-story prev " style="background-image: url(/assets/images/office01.jpg)" href="/python-star-asterisk-args-kwargs">
            <section class="post">
                <h2>Python 별표(*) 문법(asterisk/star syntax), *args와 **kwargs</h2>
                <p>Python에는 우리나라에서 흔히 별표라 부르는 asterisk(*)를 활용한 특이한 문법(syntax)가 있습니다. *args, **kwargs라고 해도 통합니다. C나...</p>
            </section>
        </a>
    
    <!-- [[! /prev_post ]] -->
</aside>

<!-- /post -->


        <!-- The tiny footer at the very bottom -->
        <footer class="site-footer clearfix">
          <section class="copyright"><a href="/">직장인을 위한 Python</a> &copy; 2020</section>
          <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> using <a href="https://github.com/jekyller/jasper">Jasper</a></section>
        </footer>
    </div>
    <!-- highlight.js -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- jQuery needs to come before `` so that jQuery can be used in code injection -->
    <script type="text/javascript" src="//code.jquery.com/jquery-1.12.0.min.js"></script>
    <!-- Ghost outputs important scripts and data with this tag -->
    <!--  -->
    <!-- Add Google Analytics  -->
        <!-- Google Analytics Tracking code -->
     <script>
	    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	    ga('create', 'UA-69281367-1', 'auto');
	    ga('send', 'pageview');

     </script>
    <!-- Fitvids makes video embeds responsive and awesome -->
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <!-- The main JavaScript file for Casper -->
    <script type="text/javascript" src="/assets/js/index.js"></script>

</body>
</html>
