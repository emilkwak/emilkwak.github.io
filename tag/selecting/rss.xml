<?xml version="1.0" encoding="UTF-8" ?>

<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
<channel>
   
      <title>emilkwak.github.io/</title>
   
   <link>http://0.0.0.0:7070</link>
   <description>Python, Pandas를 Excel보다 사랑하는 직장인을 위한 블로그 </description>
   <language>en-uk</language>
   <managingEditor> </managingEditor>
   <atom:link href="rss" rel="self" type="application/rss+xml" />
   
	<item>
	  <title>데이터프레임(DataFrame) 인덱싱(indexing), 셀렉팅(selecting)한 상태에서 값 수정하기(loc[] 사용)</title>
	  <link>//dataframe-update-after-indexing-selecting</link>
	  <author></author>
	  <pubDate>2020-02-03T08:00:00+09:00</pubDate>
	  <guid>//dataframe-update-after-indexing-selecting</guid>
	  <description><![CDATA[
	     <p><code class="highlighter-rouge">pandas</code>를 사용하다 보면 <code class="highlighter-rouge">DataFrame</code>의 일부 행과 일부 열에 대해서만 부분적으로 수정을 가해야 할 때가 생깁니다. 인덱싱(indexing)과 셀렉팅(selecting)을 통해 수정을 가할 부분을 어떻게든 찾은 다음에, 어떤 방법을 써야 실제적인 수정이 이뤄지는지 알아 보겠습니다.</p>

<p>선 다음과 같은 샘플 데이터셋을 통해 <code class="highlighter-rouge">DataFrame</code>을 만들어 보겠습니다. Forbes가 발표한 2019년 미국 최우수 대학교 순위 자료입니다. 1위부터 10위까지만 추렸고 4개의 헤더(<code class="highlighter-rouge">RANK</code>, <code class="highlighter-rouge">NAME</code>, <code class="highlighter-rouge">STATE</code>, <code class="highlighter-rouge">SALARY</code>)는 각각 순위, 대학교명, 소재주, 평균초봉에 해당합니다.
(참고: <a href="https://www.forbes.com/top-colleges/#53e27aed1987">[Forbes] America’s Top Colleges 2019</a>)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>

<span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="s">'RANK'</span><span class="p">,</span> <span class="s">'NAME'</span><span class="p">,</span> <span class="s">'STATE'</span><span class="p">,</span> <span class="s">'SALARY'</span><span class="p">]</span>
<span class="n">data</span> <span class="o">=</span>\
<span class="p">[[</span><span class="s">'1'</span><span class="p">,</span> <span class="s">'Harvard University'</span><span class="p">,</span> <span class="s">'Massachusetts'</span><span class="p">,</span> <span class="s">'74800'</span><span class="p">],</span>
 <span class="p">[</span><span class="s">'2'</span><span class="p">,</span> <span class="s">'Stanford University'</span><span class="p">,</span> <span class="s">'California'</span><span class="p">,</span> <span class="s">'79000'</span><span class="p">],</span>
 <span class="p">[</span><span class="s">'3'</span><span class="p">,</span> <span class="s">'Yale University'</span><span class="p">,</span> <span class="s">'Connecticut'</span><span class="p">,</span> <span class="s">'70300'</span><span class="p">],</span>
 <span class="p">[</span><span class="s">'4'</span><span class="p">,</span> <span class="s">'Massachusetts Institute of Technology'</span><span class="p">,</span> <span class="s">'Massachusetts'</span><span class="p">,</span> <span class="s">'86300'</span><span class="p">],</span>
 <span class="p">[</span><span class="s">'5'</span><span class="p">,</span> <span class="s">'Princeton University'</span><span class="p">,</span> <span class="s">'New Jersey'</span><span class="p">,</span> <span class="s">'75200'</span><span class="p">],</span>
 <span class="p">[</span><span class="s">'6'</span><span class="p">,</span> <span class="s">'University of Pennsylvania'</span><span class="p">,</span> <span class="s">'Pennsylvania'</span><span class="p">,</span> <span class="s">'72800'</span><span class="p">],</span>
 <span class="p">[</span><span class="s">'7'</span><span class="p">,</span> <span class="s">'Brown University'</span><span class="p">,</span> <span class="s">'Rhode Island'</span><span class="p">,</span> <span class="s">'68200'</span><span class="p">],</span>
 <span class="p">[</span><span class="s">'8'</span><span class="p">,</span> <span class="s">'California Institute of Technology'</span><span class="p">,</span> <span class="s">'California'</span><span class="p">,</span> <span class="s">'84100'</span><span class="p">],</span>
 <span class="p">[</span><span class="s">'9'</span><span class="p">,</span> <span class="s">'Duke University'</span><span class="p">,</span> <span class="s">'North Carolina'</span><span class="p">,</span> <span class="s">'71100'</span><span class="p">],</span>
 <span class="p">[</span><span class="s">'10'</span><span class="p">,</span> <span class="s">'Dartmouth College'</span><span class="p">,</span> <span class="s">'New Hampshire'</span><span class="p">,</span> <span class="s">'71500'</span><span class="p">]]</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">header</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">SALARY</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">SALARY</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</code></pre></div></div>
<p>위 <code class="highlighter-rouge">df</code> 변수에 완성된 데이터가 들어가 있습니다. 어떻게 생긴 데이터인지 한번 볼까요?</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="s">'''
	RANK	NAME	STATE	SALARY
0	1	Harvard University	Massachusetts	74800
1	2	Stanford University	California	79000
2	3	Yale University	Connecticut	70300
3	4	Massachusetts Institute of Technology	Massachusetts	86300
4	5	Princeton University	New Jersey	75200
5	6	University of Pennsylvania	Pennsylvania	72800
6	7	Brown University	Rhode Island	68200
7	8	California Institute of Technology	California	84100
8	9	Duke University	North Carolina	71100
9	10	Dartmouth College	New Hampshire	71500
'''</span>
</code></pre></div></div>
<p><code class="highlighter-rouge">STATE</code>가 캘리포니아(California)인 것만 찾아 그 <code class="highlighter-rouge">STATE</code> CALIFORNIA로 변경해 보겠습니다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">STATE</span> <span class="o">==</span> <span class="s">'California'</span><span class="p">]</span><span class="o">.</span><span class="n">STATE</span> <span class="o">=</span> <span class="s">'CALIFORNIA'</span>
<span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="s">'''
/usr/anaconda3/lib/python3.7/site-packages/pandas/core/generic.py:5208: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  self[name] = value
  
	RANK	NAME	STATE	SALARY
0	1	Harvard University	Massachusetts	74800
1	2	Stanford University	California	79000
2	3	Yale University	Connecticut	70300
3	4	Massachusetts Institute of Technology	Massachusetts	86300
4	5	Princeton University	New Jersey	75200
5	6	University of Pennsylvania	Pennsylvania	72800
6	7	Brown University	Rhode Island	68200
7	8	California Institute of Technology	California	84100
8	9	Duke University	North Carolina	71100
9	10	Dartmouth College	New Hampshire	71500
'''</span>
</code></pre></div></div>
<p><code class="highlighter-rouge">SettingWithCopyWarning</code>이 발생했고 변경하려 했던 <code class="highlighter-rouge">df</code>의 부분도 바뀌지 않고 그대로 있습니다. 우리가 했던 변경 작업이 <code class="highlighter-rouge">df</code> 원본이 아니라 그것을 복사(copy)한 후 변경 처리한 결과라는 것입니다. 당연히 원본인 <code class="highlighter-rouge">df</code>는 아무런 영향을 받지 않은 것이고요.</p>

<p>그러면 어떻게 해야 할까요? 다음과 같이 <code class="highlighter-rouge">loc[]</code>와 <code class="highlighter-rouge">mask</code>를 이용한 방법이 가장 깔끔합니다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mask = df.STATE == 'California'
df.loc[mask, 'STATE'] = 'CALIFORNIA'
display(df)
'''
	RANK	NAME	STATE	SALARY
0	1	Harvard University	Massachusetts	74800
1	2	Stanford University	CALIFORNIA	79000
2	3	Yale University	Connecticut	70300
3	4	Massachusetts Institute of Technology	Massachusetts	86300
4	5	Princeton University	New Jersey	75200
5	6	University of Pennsylvania	Pennsylvania	72800
6	7	Brown University	Rhode Island	68200
7	8	California Institute of Technology	CALIFORNIA	84100
8	9	Duke University	North Carolina	71100
9	10	Dartmouth College	New Hampshire	71500
'''
</code></pre></div></div>
<p><code class="highlighter-rouge">STATE</code> 열을 보면 california였던 것이 모두 CALIFORNIA로 바뀌었습니다. 마찬가지 방법으로, 조금 더 복잡한 작업을 해 보시죠. 평균초봉이 80000 이상이면 대학교명을 모두 대문자 처리하는 코드를 작성해 보겠습니다.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mask = df.SALARY &gt; 80000
df.loc[mask, 'NAME'] = df[mask].NAME.str.upper()
display(df)
'''
	RANK	NAME	STATE	SALARY
0	1	Harvard University	Massachusetts	74800
1	2	Stanford University	CALIFORNIA	79000
2	3	Yale University	Connecticut	70300
3	4	MASSACHUSETTS INSTITUTE OF TECHNOLOGY	Massachusetts	86300
4	5	Princeton University	New Jersey	75200
5	6	University of Pennsylvania	Pennsylvania	72800
6	7	Brown University	Rhode Island	68200
7	8	CALIFORNIA INSTITUTE OF TECHNOLOGY	CALIFORNIA	84100
8	9	Duke University	North Carolina	71100
9	10	Dartmouth College	New Hampshire	71500
'''
</code></pre></div></div>
<p>평균초봉이 86300인 MIT와 84100인 CALTECH, 두 군데의 학교명이 대문자 처리되었습니다. 세계적인 공과대학 두 곳인데, 역시 대단하군요.</p>

<p><code class="highlighter-rouge">DataFrame</code>을 인덱싱, 셀렉팅할 경우 원래의 <code class="highlighter-rouge">DataFrame</code>이 아닌 그것의 복사본을 생성해 반환하게 됩니다. 따라서 그것에 수정을 가해도 원본이 바뀌지는 않는 것입니다. 한편, <code class="highlighter-rouge">mask</code>와 <code class="highlighter-rouge">loc[]</code>을 이용하면 복사본을 생성하지 않고 원본을 유지하고 수정도 원본에 직접 가할 수 있습니다.</p>

	  ]]></description>
	</item>


</channel>
</rss>
